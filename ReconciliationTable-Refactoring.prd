# PRD - RefatoraÃ§Ã£o ReconciliationTable.tsx

## ğŸ“‹ VisÃ£o Geral

**Objetivo**: Refatorar o componente `ReconciliationTable.tsx` (821 linhas) em componentes menores e mais gerenciÃ¡veis, mantendo 100% da funcionalidade e UI existentes.

**Status**: Planejamento Completo âœ…  
**Prioridade**: MÃ©dia  
**Estimativa**: 8-12 horas de desenvolvimento  

---

## ğŸ¯ Objetivos EspecÃ­ficos

### Objetivos PrimÃ¡rios
- âœ… Melhorar a manutenibilidade do cÃ³digo
- âœ… Facilitar testes unitÃ¡rios
- âœ… Reduzir complexidade cognitiva
- âœ… Seguir princÃ­pios de responsabilidade Ãºnica
- âœ… Manter performance otimizada

### Objetivos SecundÃ¡rios
- âœ… Facilitar reutilizaÃ§Ã£o de componentes
- âœ… Melhorar legibilidade do cÃ³digo
- âœ… Preparar base para futuras funcionalidades

---

## ğŸ“Š AnÃ¡lise Atual

### MÃ©tricas do Componente Atual
- **Linhas de cÃ³digo**: 821 linhas
- **Responsabilidades**: 7+ diferentes
- **Complexidade**: Alta
- **Testabilidade**: Baixa
- **ReutilizaÃ§Ã£o**: Limitada

### Componentes Identificados para ExtraÃ§Ã£o
1. **TableHeader** (CabeÃ§alho da tabela)
2. **TableRow** (Linha individual da tabela)
3. **ActionButtons** (BotÃµes de aÃ§Ã£o)
4. **StatusBadge** (Badge de status)
5. **ValueCell** (CÃ©lula de valores monetÃ¡rios)
6. **SelectionCheckbox** (Checkbox de seleÃ§Ã£o)
7. **PaginationControls** (Controles de paginaÃ§Ã£o)

---

## ğŸ—ï¸ Arquitetura Proposta

### Estrutura de Arquivos
```
src/components/reconciliation/
â”œâ”€â”€ ReconciliationTable.tsx (componente principal - reduzido)
â”œâ”€â”€ parts/
â”‚   â”œâ”€â”€ TableHeader.tsx
â”‚   â”œâ”€â”€ TableRow.tsx
â”‚   â”œâ”€â”€ ActionButtons.tsx
â”‚   â”œâ”€â”€ StatusBadge.tsx
â”‚   â”œâ”€â”€ ValueCell.tsx
â”‚   â”œâ”€â”€ SelectionCheckbox.tsx
â”‚   â””â”€â”€ PaginationControls.tsx
â””â”€â”€ types/
    â””â”€â”€ table-parts.ts (tipos especÃ­ficos)
```

### Hierarquia de Componentes
```
ReconciliationTable
â”œâ”€â”€ TableHeader
â”‚   â””â”€â”€ SelectionCheckbox (header)
â”œâ”€â”€ TableRow (para cada movimento)
â”‚   â”œâ”€â”€ SelectionCheckbox
â”‚   â”œâ”€â”€ StatusBadge
â”‚   â”œâ”€â”€ ValueCell (mÃºltiplas)
â”‚   â””â”€â”€ ActionButtons
â””â”€â”€ PaginationControls
```

---

## ğŸ”§ EspecificaÃ§Ãµes TÃ©cnicas

### 1. TableHeader Component
```typescript
interface TableHeaderProps {
  hasSelection: boolean;
  selectedCount: number;
  totalCount: number;
  onSelectAll: (selected: boolean) => void;
  allSelected: boolean;
  partiallySelected: boolean;
}
```

**Responsabilidades**:
- Renderizar cabeÃ§alho da tabela
- Gerenciar seleÃ§Ã£o mÃºltipla (select all)
- Exibir contador de selecionados

### 2. TableRow Component
```typescript
interface TableRowProps {
  movement: ImportedMovement;
  isSelected: boolean;
  hasSelection: boolean;
  onSelect: (id: string, selected: boolean) => void;
  onAction: (action: ReconciliationAction, movement: ImportedMovement) => void;
}
```

**Responsabilidades**:
- Renderizar linha individual
- Gerenciar seleÃ§Ã£o individual
- Coordenar sub-componentes

### 3. ActionButtons Component
```typescript
interface ActionButtonsProps {
  movement: ImportedMovement;
  onAction: (action: ReconciliationAction, movement: ImportedMovement) => void;
}
```

**Responsabilidades**:
- Renderizar botÃµes de aÃ§Ã£o
- Determinar aÃ§Ãµes disponÃ­veis
- Executar callbacks de aÃ§Ã£o

### 4. StatusBadge Component
```typescript
interface StatusBadgeProps {
  status: ReconciliationStatus;
  paymentStatus?: PaymentStatus;
  className?: string;
}
```

**Responsabilidades**:
- Renderizar badge de status
- Aplicar cores e estilos corretos
- Suportar diferentes tipos de status

### 5. ValueCell Component
```typescript
interface ValueCellProps {
  value: number;
  type: 'currency' | 'percentage';
  className?: string;
  highlight?: boolean;
}
```

**Responsabilidades**:
- Formatar valores monetÃ¡rios
- Aplicar formataÃ§Ã£o de porcentagem
- Destacar valores quando necessÃ¡rio

### 6. SelectionCheckbox Component
```typescript
interface SelectionCheckboxProps {
  checked: boolean;
  indeterminate?: boolean;
  onChange: (checked: boolean) => void;
  disabled?: boolean;
}
```

**Responsabilidades**:
- Renderizar checkbox customizado
- Suportar estado indeterminado
- Gerenciar interaÃ§Ãµes

### 7. PaginationControls Component
```typescript
interface PaginationControlsProps {
  pagination: {
    page: number;
    limit: number;
    total: number;
    onPageChange: (page: number) => void;
    onLimitChange: (limit: number) => void;
  };
}
```

**Responsabilidades**:
- Renderizar controles de paginaÃ§Ã£o
- Gerenciar mudanÃ§as de pÃ¡gina
- Controlar itens por pÃ¡gina

---

## ğŸ“‹ Plano de ExecuÃ§Ã£o

### Fase 1: PreparaÃ§Ã£o (1-2h)
1. âœ… Criar estrutura de pastas `parts/`
2. âœ… Definir interfaces TypeScript
3. âœ… Configurar exports no `index.ts`

### Fase 2: ExtraÃ§Ã£o Sequencial (4-6h)
1. **StatusBadge** (mais simples, sem estado)
2. **ValueCell** (formataÃ§Ã£o, sem estado)
3. **SelectionCheckbox** (interaÃ§Ã£o simples)
4. **ActionButtons** (lÃ³gica condicional)
5. **PaginationControls** (estado complexo)
6. **TableHeader** (coordenaÃ§Ã£o)
7. **TableRow** (integraÃ§Ã£o)

### Fase 3: IntegraÃ§Ã£o (2-3h)
1. âœ… Atualizar `ReconciliationTable.tsx`
2. âœ… Remover cÃ³digo duplicado
3. âœ… Ajustar imports e exports

### Fase 4: ValidaÃ§Ã£o (1-2h)
1. âœ… Testes de funcionalidade
2. âœ… VerificaÃ§Ã£o de UI
3. âœ… Performance check
4. âœ… Lint e type-check

---

## âœ… CritÃ©rios de AceitaÃ§Ã£o

### Funcionalidade
- [ ] Todas as funcionalidades existentes mantidas
- [ ] SeleÃ§Ã£o mÃºltipla funcionando
- [ ] AÃ§Ãµes de reconciliaÃ§Ã£o funcionando
- [ ] PaginaÃ§Ã£o funcionando
- [ ] Filtros funcionando
- [ ] Modais funcionando

### Qualidade de CÃ³digo
- [ ] Componentes com responsabilidade Ãºnica
- [ ] Interfaces TypeScript bem definidas
- [ ] Props tipadas corretamente
- [ ] Sem cÃ³digo duplicado
- [ ] AIDEV-NOTEs adicionados

### Performance
- [ ] Sem regressÃ£o de performance
- [ ] MemoizaÃ§Ã£o adequada
- [ ] Re-renders otimizados

### UI/UX
- [ ] Interface idÃªntica Ã  atual
- [ ] AnimaÃ§Ãµes preservadas
- [ ] Responsividade mantida
- [ ] Acessibilidade preservada

---

## ğŸš¨ Riscos e MitigaÃ§Ãµes

### Riscos Identificados
1. **Quebra de funcionalidade**
   - *MitigaÃ§Ã£o*: Testes extensivos apÃ³s cada extraÃ§Ã£o
   
2. **RegressÃ£o de performance**
   - *MitigaÃ§Ã£o*: Profiling antes e depois
   
3. **InconsistÃªncia de tipos**
   - *MitigaÃ§Ã£o*: TypeScript strict mode
   
4. **Perda de contexto**
   - *MitigaÃ§Ã£o*: AIDEV-NOTEs detalhados

### Plano de Rollback
- Manter branch de backup
- Commits atÃ´micos por componente
- Possibilidade de reverter individualmente

---

## ğŸ“ˆ BenefÃ­cios Esperados

### Imediatos
- âœ… CÃ³digo mais legÃ­vel e organizizado
- âœ… Facilidade para debugging
- âœ… Testes unitÃ¡rios mais simples

### MÃ©dio Prazo
- âœ… Desenvolvimento mais rÃ¡pido de features
- âœ… Menor chance de bugs
- âœ… Onboarding mais fÃ¡cil para novos devs

### Longo Prazo
- âœ… ReutilizaÃ§Ã£o de componentes
- âœ… ManutenÃ§Ã£o mais eficiente
- âœ… Base sÃ³lida para expansÃµes

---

## ğŸ” MÃ©tricas de Sucesso

### Quantitativas
- ReduÃ§Ã£o de 821 â†’ ~400 linhas no arquivo principal
- 7 novos componentes especializados
- 0 regressÃµes funcionais
- 100% cobertura de tipos TypeScript

### Qualitativas
- Melhoria na legibilidade (avaliaÃ§Ã£o da equipe)
- Facilidade de manutenÃ§Ã£o (tempo para implementar mudanÃ§as)
- SatisfaÃ§Ã£o do desenvolvedor

---

## ğŸ“ Notas de ImplementaÃ§Ã£o

### PadrÃµes a Seguir
- Usar `memo()` para componentes puros
- Implementar `useCallback()` para funÃ§Ãµes passadas como props
- Manter consistÃªncia com design system Shadcn/UI
- Seguir convenÃ§Ãµes de nomenclatura do projeto

### AIDEV-NOTEs ObrigatÃ³rios
```typescript
// AIDEV-NOTE: Componente extraÃ­do de ReconciliationTable para melhor organizaÃ§Ã£o
// Responsabilidade: [descrever responsabilidade especÃ­fica]
// Props: [listar props principais e seus propÃ³sitos]
// Estado: [descrever se tem estado interno ou Ã© stateless]
```

---

## ğŸ¯ PrÃ³ximos Passos

1. **AprovaÃ§Ã£o do PRD** âœ…
2. **InÃ­cio da implementaÃ§Ã£o** (Fase 1)
3. **Reviews incrementais** (apÃ³s cada componente)
4. **Testes de integraÃ§Ã£o** (Fase 4)
5. **Deploy e monitoramento**

---

**Documento criado em**: [Data atual]  
**ResponsÃ¡vel**: Barcelitos AI Assistant  
**RevisÃ£o**: Pendente  
**AprovaÃ§Ã£o**: Pendente  

---

*Este PRD segue as melhores prÃ¡ticas de documentaÃ§Ã£o tÃ©cnica e serve como guia completo para a refatoraÃ§Ã£o do ReconciliationTable.tsx, garantindo que todos os aspectos tÃ©cnicos, funcionais e de qualidade sejam considerados durante a implementaÃ§Ã£o.*